import{r,a as re,d as le,m as I,j as e}from"./index-D9x9yDo8.js";function ie({title:h,titleId:d,...x},b){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:b,"aria-labelledby":d},x),h?r.createElement("title",{id:d},h):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 16.5V9.75m0 0 3 3m-3-3-3 3M6.75 19.5a4.5 4.5 0 0 1-1.41-8.775 5.25 5.25 0 0 1 10.233-2.33 3 3 0 0 1 3.758 3.848A3.752 3.752 0 0 1 18 19.5H6.75Z"}))}const ce=r.forwardRef(ie);function de({title:h,titleId:d,...x},b){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:b,"aria-labelledby":d},x),h?r.createElement("title",{id:d},h):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm10.5-11.25h.008v.008h-.008V8.25Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z"}))}const B=r.forwardRef(de),pe=()=>{var A,$;const h=re(),[d,x]=r.useState(""),[b,k]=r.useState(null),[S,U]=r.useState(null),[C,T]=r.useState(""),M=localStorage.getItem("testId"),[u,G]=r.useState(null),m=le(),V=(A=m.state)==null?void 0:A.testId,L=($=m.state)==null?void 0:$.type,{questionId:O,testIdForUp:j,mode:v}=m.state||{};r.useEffect(()=>{var s;((s=m.state)==null?void 0:s.mode)==="Edit"&&O&&j&&P(O)},[m.state]);const[w,y]=r.useState([{text:"Option 1",image:null,base64:null},{text:"Option 2",image:null,base64:null},{text:"Option 3",image:null,base64:null}]),[Z,E]=r.useState(!1),[Q,R]=r.useState(null),[q,F]=r.useState(null),[g,f]=r.useState([{option:"a",traits:[{name:"trait1",weight:5},{name:"trait2",weight:1}]}]),z=()=>{f([...g,{option:"",traits:[{name:"",weight:""}]}])},D=s=>{const t=[...g];t.splice(s,1),f(t)},H=s=>{const t=[...g];t[s].traits.push({name:"",weight:""}),f(t)},J=(s,t)=>{const a=[...g];a[s].traits.splice(t,1),f(a)},K=(s,t,a)=>{const o=[...g];o[s][t]=a,f(o)},_=(s,t,a,o)=>{const n=[...g];n[s].traits[t][a]=o,f(n)},X=()=>y([...w,{text:"",image:null,base64:null}]),Y=s=>y(w.filter((t,a)=>a!==s)),ee=(s,t)=>{const a=[...w];a[s].text=t,y(a)},te=(s,t)=>{const a=new FileReader;a.readAsDataURL(s),a.onload=()=>t(a.result),a.onerror=o=>console.error("Error converting to base64:",o)},se=s=>{const t=s.target.files[0];if(!t)return;if(!["image/png","image/jpeg","image/jpg"].includes(t.type)){alert("Only PNG, JPG, and JPEG files are allowed.");return}R(t),te(t,o=>{if(q==="question")k(URL.createObjectURL(t)),U(o);else if(q!==null){const n=[...w];n[q].image=URL.createObjectURL(t),n[q].base64=o,y(n)}}),setTimeout(()=>{R(null),F(null),E(!1)},3e3)},ae=async s=>{var t,a;try{const o=await I.get(`undefined/admin/show-test?testId=${s}`);(t=o==null?void 0:o.data)!=null&&t.success?G((a=o==null?void 0:o.data)==null?void 0:a.data):alert("Test not found!")}catch(o){console.error("Error fetching test data:",o),alert("Error fetching test data.")}};r.useEffect(()=>{j&&ae(j)},[j]),console.log("my test type when updating the question ",u==null?void 0:u.type);const P=async s=>{var t;try{const o=(await I.get(`undefined/admin/show-question?quesId=${s}`)).data.data,n=Array.isArray(o)?o[0]:(t=o.questions)==null?void 0:t.find(c=>c.id===s);if(!n)return;x(n.problemStatement),T(n.correctOption||"");const l=Object.entries(n.options||{}).map(([c,i])=>{const p=/^data:image\/|https?:\/\/.+\.(jpeg|jpg|png|webp|gif)$/i.test(i);return{text:p?"":i,image:p?i:null,base64:p?i:null}});if(y(l),n.problemImageUrl&&k(n.problemImageUrl),n.personalityWeight){const c=n.personalityWeight.map(i=>({option:i.option,traits:Object.entries(i.weights).map(([p,N])=>({name:p,weight:N}))}));f(c)}}catch(a){console.error("Error fetching question:",a),alert("Failed to load question for editing.")}};r.useEffect(()=>{var s;((s=m.state)==null?void 0:s.mode)==="Edit"&&O&&j&&P(O)},[m.state]);const ne=async()=>{var W;const s=(W=m.state)==null?void 0:W.questionId,t=v==null?void 0:v.toLowerCase();console.log("Mode:",t);const a=["a","b","c","d","e"],o=w.reduce((l,c,i)=>(l[a[i]]=c.base64?c.base64:c.text.trim(),l),{});let n={problemStatement:d,options:o};if(!d){alert("Please enter a question.");return}if((u==null?void 0:u.type)==="Technical"||L==="Technical"){if(!C.trim()||!o[C]){alert("Please select a valid correct option.");return}n.correctOption=C,n.personalityWeight="no"}else if((u==null?void 0:u.type)==="Personality"||L==="Personality"){const l=g.map(c=>{const i={};for(const p of c.traits){const N=parseInt(p.weight,10);if(!p.name||isNaN(N)||N<0){alert("Invalid trait or weight. Weight must be a non-negative number.");return}i[p.name]=N}return{option:c.option,weights:i}});n.correctOption="a",n.personalityWeight=l}if(t==="edit"){n.quesId=s,n.problemImage=S||"",console.log("Edit Payload---------------------------:",n);try{(await I.put("undefined/admin/update-question",n,{headers:{"Content-Type":"application/json"}})).status===200?alert("Question updated successfully!"):alert("Failed to update question.")}catch(l){console.error("Error updating question:",l),alert("Error updating question.")}}else{n.testId=V||M,n.problemImage=S||"";try{(await I.post("undefined/admin/add-question",n,{headers:{"Content-Type":"application/json"}})).status===200?(alert("Question saved successfully!"),x(""),k(null),U(null),T(""),y([{text:"Option 1",image:null,base64:null},{text:"Option 2",image:null,base64:null}])):alert("Failed to save question.")}catch(l){console.error("Error saving question:",l),alert("Error saving question.")}}},oe=()=>{h(-1)};return e.jsxs("div",{className:"max-w-6xl mx-auto bg-white shadow-md rounded-lg p-4 drop-shadow-[2px_2px_2px_rgba(0,0,0,0.6)]",children:[e.jsx("h1",{className:"text-2xl font-bold  text-center mb-7 mt-4 py-2 rounded-md shadow-2xl drop-shadow-[2px_2px_2px_rgba(0,0,0,0.6)]",style:{backgroundColor:"#FDC700"},children:e.jsxs("span",{className:"drop-shadow-[2px_2px_2px_rgba(0,0,0,0.6)]",children:[" ",v==="Edit"?"Update Question For Test":"Create Questions For Test"]})}),e.jsxs("div",{className:"flex flex-col space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("textarea",{value:d,onChange:s=>x(s.target.value),placeholder:"Enter your question...",className:"flex-grow border-b border-gray-400 focus:border-yellow-500 p-2 focus:outline-none text-lg resize-none w-full",rows:"2"}),e.jsx("button",{className:"p-2 rounded-lg hover:bg-gray-200",onClick:()=>{F("question"),E(!0)},children:e.jsx(B,{className:"w-6 h-6 text-gray-600"})}),e.jsx("div",{className:"flex items-center border border-gray-300 px-4 py-2 rounded-lg",children:e.jsx("span",{className:"text-gray-700 text-nowrap",children:"Multiple choice"})})]}),b&&e.jsx("img",{src:b,alt:"Question",className:"w-15 h-15 rounded-lg mx-auto"})]}),e.jsxs("div",{className:"mt-4",children:[w.map((s,t)=>e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("input",{type:"radio",disabled:!0,className:"mr-2"}),e.jsx("textarea",{value:s.text,onChange:a=>ee(t,a.target.value),placeholder:"Option",className:"border-b border-gray-300 focus:border-purple-500 p-2 w-full focus:outline-none resize-none",rows:"1"}),e.jsx("button",{className:"p-2 rounded-lg hover:bg-gray-200",onClick:()=>{F(t),E(!0)},children:e.jsx(B,{className:"w-5 h-5 text-gray-600"})}),s.image&&e.jsx("img",{src:s.image,alt:"Option",className:"w-10 h-10 rounded"}),e.jsx("button",{onClick:()=>Y(t),className:"text-gray-500 hover:text-red-500",children:"✖"})]},t)),e.jsx("div",{className:"flex items-center mt-2",children:e.jsx("button",{onClick:X,className:"text-blue-600 hover:underline",children:"Add option"})})]}),e.jsx("div",{className:"flex items-center mt-2 flex-col",children:e.jsx("input",{type:"text",value:C,onChange:s=>T(s.target.value),placeholder:"Enter Correct Option",className:"border-b border-gray-300 focus:border-yellow-500 w-full focus:outline-none resize-none"})}),e.jsxs("div",{className:"mt-4 w-full",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Personality Weights"}),g.map((s,t)=>e.jsxs("div",{className:"border p-4 mb-3 rounded-md bg-gray-50 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("label",{className:"w-20",children:"Option:"}),e.jsx("input",{type:"text",value:s.option,onChange:a=>K(t,"option",a.target.value),className:"border px-2 py-1 rounded w-20",maxLength:1}),e.jsx("button",{onClick:()=>D(t),className:"text-red-500 hover:underline ml-auto",children:"Remove Option"})]}),s.traits.map((a,o)=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("label",{className:"w-20",children:"Trait:"}),e.jsx("input",{type:"text",value:a.name,onChange:n=>_(t,o,"name",n.target.value),placeholder:"trait1",className:"border px-2 py-1 rounded w-32"}),e.jsx("label",{children:"Weight:"}),e.jsx("input",{type:"number",min:"0",value:a.weight,onChange:n=>_(t,o,"weight",n.target.value),className:"border px-2 py-1 rounded w-20"}),e.jsx("button",{onClick:()=>J(t,o),className:"text-red-500 hover:underline",children:"✖"})]},o)),e.jsx("button",{onClick:()=>H(t),className:"text-blue-600 mt-2 hover:underline",children:"➕ Add Trait"})]},t)),e.jsx("button",{onClick:z,className:"bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600",children:"➕ Add Option"})]}),e.jsxs("div",{className:"flex justify-between items-center border-t mt-4 pt-3",children:[e.jsx("button",{onClick:oe,className:"bg-yellow-500 text-white px-4 py-2 rounded-lg hover:bg-yellow-600",children:"Go Back"}),e.jsx("button",{onClick:ne,className:"bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600",children:v==="Edit"?"Update Question":"Create Question"})]}),Z&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50",children:e.jsxs("div",{className:"bg-white p-10 rounded-lg shadow-lg max-w-md w-full",children:[e.jsx("h2",{className:"text-lg font-medium mb-4",children:"Insert Image"}),e.jsx("div",{className:"flex flex-col items-center justify-center p-6 border-2 border-dashed border-gray-300 rounded-lg bg-gray-50 hover:bg-gray-100 transition",children:e.jsxs("label",{className:"flex flex-col items-center cursor-pointer",children:[e.jsx(ce,{className:"w-12 h-12 text-blue-500"}),e.jsx("span",{className:"text-gray-700 font-medium mt-2",children:Q?Q.name:"Click to Upload or Drag & Drop"}),e.jsx("input",{type:"file",onChange:se,className:"hidden",accept:".png, .jpg, .jpeg"})]})}),e.jsx("button",{onClick:()=>E(!1),className:"mt-4 px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600",children:"Close"})]})})]})};export{pe as default};
